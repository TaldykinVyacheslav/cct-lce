CctLce=(()=>{"use strict";var t={599:t=>{const{AbortController:e,AbortSignal:n}="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0;t.exports=e,t.exports.AbortSignal=n,t.exports.default=e},300:(t,e)=>{var n=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n)return n;throw new Error("unable to locate global object")}();t.exports=e=n.fetch,n.fetch&&(e.default=n.fetch.bind(n)),e.Headers=n.Headers,e.Request=n.Request,e.Response=n.Response},200:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CCT=void 0;const a=n(300),s=n(508),i=n(325);e.CCT=class{constructor({regions:t}){this.finishedLatency=!1,this.finishedBandwidth=!1,this.regions=t||[]}async fetchDatacenterInformation(t){if(!t)throw new Error("Datacenter URL missing.");const e=await a.default(t).then((t=>t.json()));this.datacenters=this.regions?e.filter((t=>this.mapDatacentersOnRegions(t))):e,this.clean(),this.lce=new s.LCE({datacenters:this.datacenters})}mapDatacentersOnRegions(t){return this.regions.map((e=>t.name.toLowerCase()===e.toLowerCase())).reduce(((t,e)=>t||e))}stopMeasurements(){this.lce.terminate()}startLatencyChecks(t){this.startMeasurementForLatency(t).then((()=>{this.finishedLatency=!0}))}async startMeasurementForLatency(t){var e;for(let n=0;n<t;n++)for(let t=0;t<this.datacenters.length;t++){const n=this.datacenters[t],a=await this.lce.getLatencyForId(n.id);if(a&&a.latency){const t=this.datacenters.findIndex((t=>t.id===n.id));null===(e=this.datacenters[t].latencies)||void 0===e||e.push(a.latency),this.datacenters[t].averageLatency=i.Util.getAverageLatency(this.datacenters[t].latencies)}}}startBandwidthChecks(t,e){this.startMeasurementForBandwidth(t,e).then((()=>{this.finishedBandwidth=!0}))}async startMeasurementForBandwidth(t,e){var n;for(let a=0;a<e;a++){const e=await this.lce.getBandwidthForId(t.id);if(e&&e.bandwidth){const a=this.datacenters.findIndex((e=>e.id===t.id));null===(n=this.datacenters[a].bandwidths)||void 0===n||n.push(e.bandwidth),this.datacenters[a].averageBandwidth=i.Util.getAverageBandwidth(this.datacenters[a].bandwidths)}}}getCurrentDatacentersSorted(){return i.Util.sortDatacenters(this.datacenters),this.datacenters}clean(){this.datacenters.forEach((t=>{t.position=0,t.averageLatency=0,t.averageBandwidth={bitsPerSecond:0,kiloBitsPerSecond:0,megaBitsPerSecond:0},t.latencies=[],t.bandwidths=[]}))}}},508:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.LCE=void 0;const a=n(300),s=n(599);class i{constructor({datacenters:t,agent:e}){this.datacenters=t,this.agent=e,this.cancelableLatencyRequests=[],this.cancelableBandwidthRequests=[],this.terminateAllCalls=!1}async runLatencyCheckForAll(){const t=[];this.datacenters.forEach((e=>{t.push(this.getLatencyFor(e))}));const e=await t,n=(await Promise.all(e)).filter((t=>null!==t));return n.sort(this.compare),this.cancelableLatencyRequests=[],n}async runBandwidthCheckForAll(){try{const t=[];for(const e of this.datacenters){if(this.terminateAllCalls)break;const n=await this.getBandwidthFor(e);t.push(n)}const e=t.filter((t=>null!==t));return e.sort(this.compare),this.cancelableBandwidthRequests=[],e}catch(t){return null}}getBandwidthForId(t){const e=this.datacenters.find((e=>e.id===t));return e?this.getBandwidthFor(e):null}getLatencyForId(t){const e=this.datacenters.find((e=>e.id===t));return e?this.getLatencyFor(e):null}async getLatencyFor(t){try{const e=Date.now();await this.latencyFetch(`https://${t.ip}/drone/index.html`);const n=Date.now();return{id:t.id,latency:n-e,cloud:t.cloud,name:t.name,town:t.town,country:t.country,latitude:t.latitude,longitude:t.longitude,ip:t.ip,timestamp:Date.now()}}catch(t){return null}}async getBandwidthFor(t){const e=Date.now(),n=await this.bandwidthFetch(`https://${t.ip}/drone/big`);if(null!==n){const a=Date.now(),s=await n.text(),r=i.calcBandwidth(s.length,a-e);return{id:t.id,bandwidth:r,cloud:t.cloud,name:t.name,town:t.town,country:t.country,latitude:t.latitude,longitude:t.longitude,ip:t.ip}}return null}bandwidthFetch(t){const e=new s.default,{signal:n}=e;return this.cancelableBandwidthRequests.push(e),this.abortableFetch(t,n)}latencyFetch(t){const e=new s.default,{signal:n}=e;return this.cancelableLatencyRequests.push(e),this.abortableFetch(t,n)}async abortableFetch(t,e){try{return await a.default(t,{signal:e})}catch(t){return console.log(t),null}}compare(t,e){return t.latency<e.latency?-1:t.latency>e.latency?1:0}terminate(){this.terminateAllCalls=!0,this.cancelableLatencyRequests.forEach((t=>{t.abort()})),this.cancelableBandwidthRequests.forEach((t=>{t.abort()})),this.cancelableLatencyRequests=[],this.cancelableBandwidthRequests=[],this.terminateAllCalls=!1}static calcBandwidth(t,e){const n=8*t/(e/1e3),a=n/1e3;return{bitsPerSecond:n,kiloBitsPerSecond:a,megaBitsPerSecond:a/1e3}}}e.LCE=i},325:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Util=void 0;class n{static deepCopy(t){return JSON.parse(JSON.stringify(t))}static getAverageLatency(t){return t?t.reduce(((t,e)=>t+e),0)/t.length:-1}static getAverageBandwidth(t){if(t){const e=t.reduce(((t,e)=>({bitsPerSecond:t.bitsPerSecond+e.bitsPerSecond,kiloBitsPerSecond:t.kiloBitsPerSecond+e.kiloBitsPerSecond,megaBitsPerSecond:t.megaBitsPerSecond+e.megaBitsPerSecond})));return{bitsPerSecond:e.bitsPerSecond/t.length,kiloBitsPerSecond:e.kiloBitsPerSecond/t.length,megaBitsPerSecond:e.megaBitsPerSecond/t.length}}return{bitsPerSecond:-1,kiloBitsPerSecond:-1,megaBitsPerSecond:-1}}static sortDatacenters(t){return t.sort(((t,e)=>t.averageLatency-e.averageLatency)),t.forEach(((t,e)=>{t.position=e+1})),t}static getTop3(t){return n.sortDatacenters(t).slice(0,3)}static sleep(t){return new Promise((e=>setTimeout(e,t)))}}e.Util=n}},e={};return function n(a){if(e[a])return e[a].exports;var s=e[a]={exports:{}};return t[a](s,s.exports,n),s.exports}(200)})();